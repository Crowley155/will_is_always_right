<!DOCTYPE html>
<html>
<head>
    <title>External Flow Launcher</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <div id="flowContainer" style="width: 100%; min-height: 400px; border: 1px solid #ccc; padding: 20px;"></div>
    <div id="debugLog" style="margin-top: 20px; padding: 10px; background: #f5f5f5; border: 1px solid #ddd;"></div>
    
    <!-- Include Lightning Out from your Salesforce org -->
    <script src="https://clearcaptions123--willdev.sandbox.my.salesforce-setup.com/lightning/lightning.out.js"></script>
    
    <script>
        // Debug logging function
        function debugLog(message) {
            console.log(message);
            const debugDiv = document.getElementById('debugLog');
            debugDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }
        
        // Lightning Out Configuration
        const SALESFORCE_CONFIG = {
            orgDomain: 'https://clearcaptions123--willdev.sandbox.my.salesforce-setup.com',
            appName: 'c:flowLauncherApp',
            containerId: 'flowContainer'
            // Note: Token may not be required for public access
        };
        
        // Flow configuration
        const FLOW_CONFIG = {
            flowName: 'Sales_Order_Acquisition_Guided_Workflow',
            autoStart: true,
            inputVariables: []
        };
        
        // Initialize Lightning Out
        function initializeLightningOut() {
            debugLog('Initializing Lightning Out...');
            
            // Try without token first (for public access)
            $Lightning.use(SALESFORCE_CONFIG.appName, function() {
                debugLog('Lightning Out app loaded successfully');
                createFlowLauncherComponent();
            }, SALESFORCE_CONFIG.orgDomain);
        }
        
        // Create the flow launcher component
        function createFlowLauncherComponent() {
            debugLog('Creating flow launcher component...');
            
            $Lightning.createComponent(
                "c:flowLauncher",
                {
                    flowName: FLOW_CONFIG.flowName,
                    autoStart: FLOW_CONFIG.autoStart,
                    flowInputVariables: FLOW_CONFIG.inputVariables
                },
                SALESFORCE_CONFIG.containerId,
                function(component) {
                    debugLog('Flow Launcher component created successfully');
                    setupEventListeners();
                }
            );
        }
        
        // Set up event listeners for flow events
        function setupEventListeners() {
            // Listen for flow events via postMessage (sent by the component)
            window.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'flowLauncherEvent') {
                    handleFlowEvent(event.data);
                }
            });
        }
        
        // Handle flow events
        function handleFlowEvent(eventData) {
            debugLog('Flow Event Received: ' + eventData.eventName);
            
            switch(eventData.eventName) {
                case 'flowStarted':
                    debugLog('Flow started: ' + eventData.flowName);
                    onFlowStarted(eventData);
                    break;
                    
                case 'flowFinished':
                    debugLog('Flow completed: ' + eventData.flowName);
                    onFlowCompleted(eventData);
                    break;
                    
                case 'flowError':
                    debugLog('Flow error: ' + eventData.flowName);
                    onFlowError(eventData);
                    break;
                    
                case 'flowPaused':
                    debugLog('Flow paused: ' + eventData.flowName);
                    onFlowPaused(eventData);
                    break;
                    
                case 'flowToast':
                    showNotification(eventData.eventData);
                    break;
                    
                default:
                    debugLog('Unknown flow event: ' + eventData.eventName);
            }
        }
        
        // Event handlers - customize these for your needs
        function onFlowStarted(eventData) {
            document.getElementById('flowContainer').style.border = '2px solid #4bca81';
        }
        
        function onFlowCompleted(eventData) {
            document.getElementById('flowContainer').style.border = '2px solid #4bca81';
            
            if (eventData.eventData && eventData.eventData.outputVariables) {
                debugLog('Flow output variables: ' + JSON.stringify(eventData.eventData.outputVariables));
            }
        }
        
        function onFlowError(eventData) {
            document.getElementById('flowContainer').style.border = '2px solid #c23934';
            showNotification({
                title: 'Flow Error',
                message: 'The flow encountered an error. Please try again.',
                type: 'error'
            });
        }
        
        function onFlowPaused(eventData) {
            document.getElementById('flowContainer').style.border = '2px solid #ffb75d';
        }
        
        // Simple notification function
        function showNotification(notification) {
            const message = `${notification.title}: ${notification.message}`;
            debugLog(message);
            
            if (notification.type === 'error') {
                console.error(message);
            }
        }
        
        // Public API for external control
        window.FlowLauncher = {
            launchFlow: function(flowName, inputVariables = []) {
                FLOW_CONFIG.flowName = flowName;
                FLOW_CONFIG.inputVariables = inputVariables;
                
                document.getElementById(SALESFORCE_CONFIG.containerId).innerHTML = '';
                createFlowLauncherComponent();
            },
            
            setInputVariables: function(inputVariables) {
                FLOW_CONFIG.inputVariables = inputVariables;
            }
        };
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('Page loaded, checking for Lightning Out...');
            
            if (typeof $Lightning !== 'undefined') {
                debugLog('Lightning Out library found');
                initializeLightningOut();
            } else {
                debugLog('ERROR: Lightning Out library not loaded');
            }
        });
        
        // Error handling for Lightning Out failures
        window.addEventListener('error', function(e) {
            debugLog('JavaScript Error: ' + e.message);
        });
    </script>
</body>
</html> 
